@model IEnumerable<SinetLeaveManagement.Models.Notification>

<h2>Notifications</h2>

@if (!Model.Any())
{
    <p>No new notifications.</p>
}
else
{
    <ul class="list-group">
        @foreach (var n in Model)
        {
            <li class="list-group-item d-flex justify-content-between align-items-center">
                @n.Message
                <button class="btn btn-sm btn-outline-secondary mark-read-btn" data-id="@n.Id">Mark as Read</button>
            </li>
        }
    </ul>
}

@section Scripts {
    <script src="~/lib/signalr/signalr.js"></script>
    <script>
        // ======================
        // SignalR connection
        // ======================
        const connection = new signalR.HubConnectionBuilder()
            .withUrl("/notificationsHub")
            .build();

        connection.on("ReceiveNotification", function(message) {
            alert(message); // simple popup, can make dropdown/badge
        });

        connection.start();

        // ======================
        // Mark as read
        // ======================
        $(".mark-read-btn").click(function() {
            var id = $(this).data("id");
            $.post("/Notifications/MarkAsRead", { id: id }, () => location.reload());
        });
    </script>
}
