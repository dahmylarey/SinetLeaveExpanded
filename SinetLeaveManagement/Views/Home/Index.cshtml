@model SinetLeaveManagement.Models.ViewModels.HomeIndexViewModel

@using Microsoft.AspNetCore.Identity
@using SinetLeaveManagement.Data
@{
    ViewData["Title"] = "Home Page";
}

<h2>Welcome</h2>
<p>You have @Model.UnreadNotificationCount unread notifications.</p>


@{
    var userManager = Context.RequestServices.GetService<UserManager<ApplicationUser>>();
    var db = Context.RequestServices.GetService<ApplicationDbContext>();
    var user = userManager?.GetUserAsync(User).Result;
    var count = user != null ? db.Notifications.Count(n => n.UserId == user.Id && !n.IsRead) : 0;
}
@await Html.PartialAsync("_NotificationBadge", count)